---
title: "MP3"
author: "Phil Kaplan, Jaan Selod, Emma Laslo"
date: "2024-03-28"
output: html_document
bibliography: BIOL5380.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

#Introduction 

  The purpose of Mini Project 3 is two-fold, (1) to quantify physical properties including Young's modulus for a segment of intestine in both circumferential and longitudinal orientations during loading and unloading phases and (2) to compare flexural stiffness of a wooden stirrer in various orientations (flat/flipped), states (wet/dry), and with different rates of mass application (fast/slow). 
  Both materials are anisotropic in that they have directionally dependent properties due to fiber arrangements. For example, wood grain is unidirectional and thus gives the material anisotropy, in that its “axial cellular elements” tend to be oriented similarly [@Bremaud2010]. Similarly, intestinal muscle is arranged both longitudinally and circumferentially, demonstrating the physiological connection between biology and function: pushing a bolus through the digestive tract.
  Young's modulus is a property that assesses the relative ease at which the material is stretched. In essence, Young's modulus is the ratio of stress to strain. According to @Patel2023, both the longitudinal and circumferential muscles of the intestine stretch and contract to enable the movement of food and waste during peristalsis. Notably, the intestine is more compliant along the circumferential axis in order to move varying volumes of food. This characteristic should be reflected in the relative difference between the Young's modulus calculated for the longitudinal and circumferential conditions. 
  Under expected conditions, the equation $\`d = (Fl^3)/3EI\'$ governs the calculated flexural stiffness for the wooden stirrer. The moment of inertia of the stirrer is dependent on its orientation. In the flipped condition, the moment of inertia should be significantly greater, resulting in greater flexural stiffness compared to the flat orientation. Water has plasticizing properties, suggesting that the observed flexural stiffness for the dry conditions should be greater than in the wet conditions [@Mvondo2017]. Finally, the rate at which the mass is applied to the stirrer is expected to have an effect on the measured flexural stiffness of the dowel. Under the slow condition, the stirrer is expected to undergo "creep", which is a gradual deformation of the material yielding larger observed flexural stiffness values. 
  
#Methods 

Intestine Section:

A pig intestine was cut into 2 sections (5-8 cm x 1 cm) both for axial and circumferential orientations relative to the original intestine. The length, width, and thickness of the sections were obtained using calipers. Intestine sections were secured to a table using a binder clip. A make-shift weight holder was then secured to the end of the intestinal section using dental floss. Pairs of 3.2 gram washers were added until a total load of 8 washers was obtained. Length measurements of the intestine were obtained after each addition of the two washers. Then, washers were unloaded in pairs (as they were added), and length measurements were obtained each time the load was decreased. 

Wood Section:

Length, width, and thickness measurements of a birch coffee stirrer were obtained. Utilizing a 3 point bending set-up, a load cell, and a program utilizing a cylinder to depress the wood, the mass required to depress the wood 1 mm was obtained. 5 total trials were conducted with varying conditions in each of the trials. In the first 4 trials, the wood was in a flat orientation. The state of the wood (wet/dry) and the speed at which the mass was applied (fast/slow) was varied for these trials. In the 5th trial, a dry piece of wood was flipped on its side and mass was applied slowly. 

# Results
```{r long data, echo = F, warning = F, message = F}
#Loading and transforming longitudinal data 

data_longitudinal <- read_csv("Intestine_Longitudinal_Final.csv")


original_length <- 0.0481

data_longitudinal <- data_longitudinal %>%
  mutate(
    weight_count = (Trial - 1) * 2,
    total_weight_mass = weight_count * 0.0032,  
    force = total_weight_mass * 9.8,             
    stress = force / 0.0000045,                 
    strain_loading = (Loading_L - original_length) / original_length,
    strain_unloading = (Unloading_L - original_length) / original_length
  ) %>% print()

fig1dat <- data_longitudinal %>%
  select(stress, strain_loading, strain_unloading) %>%
  pivot_longer(!stress, values_to = "strain", names_to = "group")

fig1dat %>%
  ggplot(aes(x=strain, y=stress, col=group)) + geom_line() + ggtitle("Figure 1: Stress-Strain Curve for Longitudinal Section of Intestine")


#Calc Young's Modulus
loading_regression_longitudinal <- lm(stress ~ strain_loading, data = data_longitudinal)
unloading_regression_longitudinal <- lm(stress ~ strain_unloading, data = data_longitudinal)

youngs_modulus_loading_longitudinal <- coef(loading_regression_longitudinal)[2]
youngs_modulus_unloading_longitudinal <- coef(unloading_regression_longitudinal)[2]


#Table 
youngs_modulus_table_longitudinal <- tibble(
  Phase = c("Loading", "Unloading"),
  Youngs_Modulus_Pascals = c(youngs_modulus_loading_longitudinal, youngs_modulus_unloading_longitudinal)
) %>% print()
```


```{r circ data, echo = F, message = F, warning = F}
#Loading and transforming circumferential data 

data_circumferential <- read_csv("Intestine_Circumferential_Final.csv")

data_circumferential <- data_circumferential %>%
  mutate(
    weight_count = (Trial - 1) * 2,
    total_weight_mass = weight_count * 0.0032,  
    force = total_weight_mass * 9.8,             
    stress = force / 0.0000034,                 
    strain_loading = (Loading_L - original_length) / original_length,
    strain_unloading = (Unloading_L - original_length) / original_length
  )

fig2dat <- data_circumferential %>%
  select(stress, strain_loading, strain_unloading) %>%
  pivot_longer(!stress, values_to = "strain", names_to = "group")

fig2dat %>%
  ggplot(aes(x=strain, y=stress, col=group)) + geom_line() + ggtitle("Figure 2: Stress-Strain Curve for Longitudinal Section of Intestine")

#Calc Young's Modulus
loading_regression_circumferential <- lm(stress ~ strain_loading, data = data_circumferential)
unloading_regression_circumferential <- lm(stress ~ strain_unloading, data = data_circumferential)


youngs_modulus_loading_circumferential <- coef(loading_regression_circumferential)[2]
youngs_modulus_unloading_circumferential <- coef(unloading_regression_circumferential)[2]

#Table 
youngs_modulus_table_circumferential <- tibble(
  Phase = c("Loading", "Unloading"),
  Youngs_Modulus_Pascals = c(youngs_modulus_loading_circumferential, youngs_modulus_unloading_circumferential)
) %>%
  print()
```

```{r wood def, echo = F, message = F, warning = F}
#Wood deflection 

process_file <- function(file_path) {
  data <- read_csv(file_path, col_names = c("Time_ms", "Mass_g"))
  data <- data %>%
    mutate(
      Time_ms = as.numeric(Time_ms),
      Mass_g = as.numeric(Mass_g)
    )
  min_mass_row <- data %>%
                  filter(Mass_g == min(Mass_g, na.rm = TRUE)) %>%
                  mutate(File = gsub("_"," ",basename(file_path)))
  
  return(min_mass_row)
}

file_paths <- c("flipped_slow_dry.txt",
                "flat_slow_wet.txt",
                "flat_slow_dry.txt",
                "flat_fast_wet.txt",
                "flat_fast_dry.txt")

results <- bind_rows(lapply(file_paths, process_file))

results <- results %>%
  mutate(
    Mass_g_abs = abs(Mass_g),
    Force_N = Mass_g_abs / 1000 * 9.81,
    length_m = 0.036,
    deflection_m = 0.001,
    EI = (Force_N * length_m^3) / (3 * deflection_m)
  ) %>% print()

orient <- results %>%
  select(File,EI) %>%
  filter(results$File == File[1] | results$File==File[3]) %>%
  mutate(Orientation = orient$File[][1]) %>%
  print() 


orient %>%
  ggplot(aes(x=File,y=EI)) + geom_point(aes(y=EI))

print(results) 
```

#Discussion 

The findings of this mini-project are generally consistent with the expectations outlined in the introduction. 
While the stress-strain curve for the longitudal orientation of the [...]

Young's modulus for both the loading and unloading phase of the circumferentially loaded intestinal section was greater than for the longitudinally loaded section. These results suggest that the intestine is anisotropic which is expected given the varying arrangements of collagen and muscle structure of the longitudinal and circumferential orientations of the intestine. This is consistent with X (study referenced in introduction). Notably, Young's modulus was greater in the unloading phase for the circumferentially loaded sample and greater in the loading phase in the longitudinally loaded sample. **Add interpretation about viscoelasticity here. The findings of the 3 point bend test of the wooden dowel also generally followed the expected results. The calculated flexural stiffness for the dry dowel was the largest comparatively at each respective speed of mass application. This is the expected result because water is a plasticizer which would result in a lower flexural stiffness for the wet dowel (Include reference to research paper about water being a plasticizer). Comparison between the flat_slow_wet and flat_fast_wet condition follows the expected result in which "creep" allowed by slow application of mass yields a larger calculated flexural stiffness. However, the calculated flexural stiffness for the flat_fast_dry was greater than than that calculated for the flat_slow_dry condition.

  
  **Add interpretations about viscoelastic properties of the intestine explaining relative changes in the loading and unloading phases. 




#Author Contributions 



